!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Tts=e():t.Tts=e()}(window,function(){return(d=[function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,N,O;N="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global?global:this,O=function(global){"use strict";global=global||{};var _Base64=global.Base64,version="2.5.1",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},r=0,n=t.length;r<n;r++)e[t.charAt(r)]=r;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(1<t.length?t.charCodeAt(1):0)<<8|(2<t.length?t.charCodeAt(2):0);return[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),2<=e?"=":b64chars.charAt(r>>>6&63),1<=e?"=":b64chars.charAt(63&r)].join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t)).toString("base64")}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t)).toString("base64")}:function(t){return btoa(utob(t))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):_encode(String(t))},encodeURI=function(t){return encode(t,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return fromCharCode(55296+(e>>>10))+fromCharCode(56320+(1023&e));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,r=e%4,n=(0<e?b64tab[t.charAt(0)]<<18:0)|(1<e?b64tab[t.charAt(1)]<<12:0)|(2<e?b64tab[t.charAt(2)]<<6:0)|(3<e?b64tab[t.charAt(3)]:0),s=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(255&n)];return s.length-=[0,0,2,1][r],s.join("")},_atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/\S{1,4}/g,cb_decode)},atob=function(t){return _atob(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(_atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(t){return encode(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return global.Meteor&&(Base64=global.Base64),module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),{Base64:global.Base64}},module.exports=O(N)}).call(this,__webpack_require__(4))},function(e,t){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function(t){return r(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)},n(t)}e.exports=n},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.r(e);var n=r(0),s=r.n(n),o=r(1),i=r.n(o),a=r(3),u=r.n(a);var h=function(){function t(){s()(this,t),this.instance=null}return i()(t,[{key:"connect",value:function(e){this.instance=new XMLHttpRequest,this.instance.onreadystatechange=function(t){this.readyState===XMLHttpRequest.DONE&&(200===this.status?e(this.responseText):e())}}},{key:"send",value:function(t,e,r,n){if(this.instance.readyState===XMLHttpRequest.UNSENT||this.instance.readyState===XMLHttpRequest.DONE){if(this.instance.open(t,e),this.instance.withCredentials=!0,n)for(var s=0;s<n.length;s++)this.instance.setRequestHeader(n[s].header,n[s].value);this.instance.send(r)}}}]),t}(),c={id:1,method:"deal_request",jsonrpc:"2.0"};function f(t){return JSON.parse(JSON.stringify(t))}function l(t){return null!=t?t:"pc20onli"}function d(t){var e=f(c),r=f(t);return r.appid=l(t.appid),r.cmd="ssb",r.svc="tts",r.syncid="0",e.params=r,e}function b(t,e,r){var n=f(c),s=f(e);return s.sid=t,s.appid=l(r),s.cmd="grs",s.svc="tts",n.params=s,n}var p=r(2),y={id:1,method:"deal_request",jsonrpc:"2.0"};function v(t){return JSON.parse(JSON.stringify(t))}var _=function(){function r(t,e){s()(this,r),this.realUrl=null,this.authUrl=null,this.net=null,this.bStart=!1,this.header=[{header:"content-type",value:"application/json-rpc"}],this.authCallback="function"==typeof e?e:function(){},this.heart=null,this.hbInfo={},this.svc=t}return i()(r,[{key:"authStart",value:function(t,e,r){if(this.realUrl=null,this.authUrl=t,this.net||(this.net=new h),this.bHB=!1!==r||r,this.authMsg=e,this.hbInfo.token=e.token,this.hbInfo.area=e.area,this.hbInfo.ability=e.ability,this.authMsg.extend_params)for(var n=JSON.parse(this.authMsg.extend_params).params.split(","),s=0;s<n.length;s++){var o=n[s].split("=");"token"!==o[0]&&"area"!==o[0]&&"ability"!==o[0]||(this.hbInfo[o[0]]=o[1])}this.hbInfo.appid=e.appid,this.hbInfo.authId=e.auth_id,this.status="ssb",this.net.connect(this.processAuthMsg.bind(this));var i=this.authBeginMsg();this.net.send("POST",t,JSON.stringify(i),this.header)}},{key:"authEnd",value:function(){this.net||(this.net=new h),this.status="sse",this.net.connect(this.processAuthMsg.bind(this));var t=this.authEndMsg();this.net.send("POST",this.authUrl,JSON.stringify(t),this.header),clearInterval(this.heart),this.heart=null}},{key:"heartBeat",value:function(){if(this.bStart){this.net||(this.net=new h);var t=this.authHBMsg();this.net.connect(this.processAuthMsg.bind(this)),this.net.send("POST",this.authUrl,JSON.stringify(t),this.header)}}},{key:"authBeginMsg",value:function(){var t=v(y),e=v(this.authMsg);return e.appid=this.authMsg.appid,e.cmd="ssb",e.svc=this.svc,t.params=e,t}},{key:"authEndMsg",value:function(){var t=v(y),e=v(this.authMsg);return e.appid=this.authMsg.appid,e.cmd="sse",e.svc=this.svc,t.params=e,t}},{key:"authHBMsg",value:function(){var t=v(y),e={batchHeartBeat:[]};return e.batchHeartBeat.push(this.hbInfo),t.params=e,t}},{key:"processAuthMsg",value:function(t){if(void 0!==t){var e=JSON.parse(p.Base64.atob(t)),r=e.result;return null==r?(this.authCallback({status:"onError",msg:e.error}),void("hb"===this.status&&(clearInterval(this.heart),this.heart=null))):0!==r.ret&&302!==r.ret?(this.authCallback({status:"onError",msg:r.ret}),void("hb"===this.status&&(clearInterval(this.heart),this.heart=null))):void("ssb"===this.status?(this.bStart=!0,this.realUrl=r.url,this.authCallback({status:"onResult",msg:this.realUrl}),this.bHB&&(this.heart=setInterval(this.heartBeat.bind(this),3e3),this.status="hb")):"sse"===this.status&&(this.bStart=!1))}"hb"===this.status&&(clearInterval(this.heart),this.heart=null)}}]),r}(),g="idle",m="ssb",S="txtw",C="grs",A="sse",E=function(){function e(t){s()(this,e),this.net=null,this.text=null,this.url=null,this.serverParams=null,this.extendParams=null,this.Status=null,this.session={id:null},this.audioProc="function"==typeof t?t:function(){},this.syncid=0,this.header=[{header:"content-type",value:"application/json-rpc"}],this.bAuth=!1,this.Auth=null}return i()(e,[{key:"onError",value:function(t){"function"==typeof t&&(this.onError=t)}},{key:"start",value:function(t,e,r,n){if(this.text=r,this.syncid=0,"object"===u()(e)&&(this.serverParams=e,this.extendParams=e.extend_params),this.net||(this.net=new h),this.bAuth=!0===n&&n,this.bAuth){var s=this;this.Auth||(this.Auth=new _("tts",function(t){if("onError"!==t.status){s.url=t.msg,s.net.connect(s.processServerMsg.bind(s));var e=d(s.serverParams);s.net.send("POST",s.url,JSON.stringify(e),s.header),s.Status=m,s.syncid++}else s.onError&&s.onError(t.msg)})),this.Auth.authStart(t,e)}else{this.url=t,this.net.connect(this.processServerMsg.bind(this));var o=d(this.serverParams);this.net.send("POST",this.url,JSON.stringify(o),this.header),this.Status=m,this.syncid++}}},{key:"abortSession",value:function(){if(this.audioProc(!0),this.Status&&this.Status!==A&&this.Status!==g){if(null!=this.session.id){var t={syncid:this.syncid.toString(),auth_id:this.serverParams.auth_id,extend_params:this.extendParams};this.net.send("POST",this.url,JSON.stringify(function(t,e,r){var n=f(c),s=f(e);return s.sid=t,s.appid=l(r),s.cmd="sse",s.svc="tts",n.params=s,n}(this.session.id,t,this.serverParams.appid)),this.header)}this.Status=A,this.bAuth&&(this.Auth.authEnd(),this.bAuth=!1)}}},{key:"processServerMsg",value:function(t){if(void 0===t)return this.onError&&this.onError("response error"),void this.abortSession();var e=JSON.parse(p.Base64.atob(t)),r=e.result;if(this.syncid++,null==r)return this.onError&&this.onError(e.error),void this.abortSession();if(0!==r.ret)return this.onError&&this.onError(r.ret),void this.abortSession();switch(this.Status){case m:this.session.id=r.sid;var n={data:p.Base64.encode(this.text),syncid:this.syncid.toString(),extend_params:this.extendParams};this.net.send("POST",this.url,JSON.stringify(function(t,e,r){var n=f(c),s=f(e);return s.sid=t,s.appid=l(r),s.cmd="txtw",s.svc="tts",n.params=s,n}(this.session.id,n,this.serverParams.appid)),this.header),this.Status=S;break;case S:var s={syncid:this.syncid.toString(),extend_params:this.extendParams};this.net.send("POST",this.url,JSON.stringify(b(this.session.id,s,this.serverParams.appid)),this.header),this.Status=C;break;case C:var o={syncid:this.syncid.toString(),extend_params:this.extendParams},i=r.data;void 0!==i&&""!==i&&this.audioProc(!1,p.Base64.atob(i)),0!==r.ttsStatus?this.net.send("POST",this.url,JSON.stringify(b(this.session.id,o,this.serverParams.appid)),this.header):this.abortSession();break;case A:this.Status=g}}}]),e}(),x=function(){function e(t){s()(this,e),this._tts=new E(t)}return i()(e,[{key:"onError",value:function(t){this._tts.onError(t)}},{key:"start",value:function(t,e,r,n){this._tts.start(t,e,r,n)}},{key:"stop",value:function(){this._tts.abortSession()}}]),e}();e.default=x}],e={},f.m=d,f.c=e,f.d=function(t,e,r){f.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},f.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},f.t=function(e,t){if(1&t&&(e=f(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(f.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)f.d(r,n,function(t){return e[t]}.bind(null,n));return r},f.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return f.d(e,"a",e),e},f.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},f.p="",f(f.s=5)).default;function f(t){if(e[t])return e[t].exports;var r=e[t]={i:t,l:!1,exports:{}};return d[t].call(r.exports,r,r.exports,f),r.l=!0,r.exports}var d,e});
//# sourceMappingURL=tts.min.js.map